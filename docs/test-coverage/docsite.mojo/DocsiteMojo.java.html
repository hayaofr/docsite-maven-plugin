<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DocsiteMojo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Docsite Maven Plugin</a> &gt; <a href="index.source.html" class="el_package">docsite.mojo</a> &gt; <span class="el_source">DocsiteMojo.java</span></div><h1>DocsiteMojo.java</h1><pre class="source lang-java linenums">package docsite.mojo;

import static java.util.Objects.requireNonNullElse;

import java.io.*;
import java.nio.file.*;
import java.util.Objects;

import docsite.util.ResourceUtil;
import org.apache.maven.plugin.*;
import org.apache.maven.plugins.annotations.*;
import org.apache.maven.plugins.annotations.Mojo;
import org.apache.maven.project.MavenProject;

import docsite.*;

@Mojo(defaultPhase = LifecyclePhase.POST_SITE, name = &quot;generate&quot;)
<span class="nc" id="L18">public class DocsiteMojo extends AbstractMojo {</span>

    /**
     * The folder where the documentation site would be generated.
     * @since 1.0
     */
    @Parameter(
        name = &quot;outputFolder&quot;,
        required = true,
        defaultValue = &quot;${project.build.directory}/docsite&quot;,
        property = &quot;docsite.outputFolder&quot;
    )
    File outputFolder;


    /**
     * Forces deletion of output folder.&lt;br/&gt;
     * A safety mechanism is implemented in order to prevent accidental deletion of directories,
     * but setting this property to &lt;tt&gt;true&lt;/tt&gt; will bypass such feature.
     *
     * @since 1.0
     */
    @Parameter(name = &quot;forceDelete&quot;, defaultValue = &quot;false&quot;, property = &quot;docsite.forceDelete&quot;)
    boolean forceDelete;


    /**
     * Defines the site estructure. If omitted, a default site estructure would be use instead.
     * &lt;pre&gt;&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
     * &amp;lt;description&amp;gt;&amp;lt;/description&amp;gt;
     * &amp;lt;logo&amp;gt;&amp;lt;/logo&amp;gt;
     * &amp;lt;index&amp;gt;&amp;lt;/index&amp;gt;
     * &amp;lt;sections&amp;gt;
     *     &amp;lt;section&amp;gt;
     *         &amp;lt;name&amp;gt;&amp;lt;/name&amp;gt;
     *         &amp;lt;description&amp;gt;&amp;lt;/description&amp;gt;
     *         &amp;lt;icon&amp;gt;&amp;lt;/icon&amp;gt;
     *         &amp;lt;source&amp;gt;&amp;lt;/source&amp;gt;
     *         &amp;lt;type&amp;gt;&amp;lt;/type&amp;gt;
     *         &amp;lt;siteIndex&amp;gt;&amp;lt;/siteIndex&amp;gt;
     *         &amp;lt;template&amp;gt;&amp;lt;/template&amp;gt;
     *         &amp;lt;replaceEmojis&amp;gt;&amp;lt;/replaceEmojis&amp;gt;
     *         &amp;lt;subsections&amp;gt;
     *             &amp;lt;section&amp;gt;
     *                 ...
     *             &amp;lt;/section&amp;gt;
     *             ...
     *         &amp;lt;/subsections&amp;gt;
     *     &amp;lt;/section&amp;gt;
     *     ...
     * &amp;lt;/sections&amp;gt;
     * &lt;/code&gt;&lt;/pre&gt;
     *
     * &lt;table style=&quot;font-size: 0.8rem&quot;&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;title&lt;/tt&gt;&lt;/td&gt;&lt;td&gt; Title of the site. Used in page headers and metadata.&lt;/td&gt;&lt;td&gt;Required&lt;/&lt;td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;description&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Brief description of the site. Used in page headers and metadata.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;logo&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;File image or &lt;a href=&quot;http://https://fontawesome.com/v5.15/icons&quot;&gt;Font Awesome icon&lt;/a&gt;. Used in page headers.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;index&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Document file (Markdown, HTML or raw text) that would be the landing page.&lt;/td&gt;&lt;td&gt;Required&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;sections&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Main sections of the page. Used in the header navigation menu.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;/table&gt;
     *
     * &lt;b&gt;Section properties:&lt;/b&gt;
     *
     * &lt;table style=&quot;font-size: 0.8rem&quot;&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;name&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Name of the section. Used in menus, breadcrumbs and metadata.&lt;/td&gt;&lt;td&gt;Required&lt;/&lt;td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;description&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Brief description of the section. Used in metadata.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;icon&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;File image or &lt;a href=&quot;http://https://fontawesome.com/v5.15/icons&quot;&gt;Font Awesome icon&lt;/a&gt;. Used in menus.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;type&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Type of the section. &lt;/td&gt;&lt;td&gt;&lt;tt&gt;generated&lt;/tt&gt;&lt;br/&gt;&lt;tt&gt;embedded&lt;/tt&gt;&lt;br/&gt;&lt;tt&gt;group&lt;/tt&gt;&lt;br/&gt;&lt;tt&gt;link&lt;/tt&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;source&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Document file used as the site contents. Not used when &lt;tt&gt;type&lt;/tt&gt; is &lt;tt&gt;group&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;siteIndex&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Main page of the embedded site. Required used when &lt;tt&gt;type&lt;/tt&gt; is &lt;tt&gt;embedded&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;template&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;A &lt;a href=&quot;https://freemarker.apache.org/&quot;&gt;Freemarker&lt;/a&gt; template file. Only used when &lt;tt&gt;type&lt;/tt&gt; is &lt;tt&gt;generated&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;replaceEmojis&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Set whether Github emoji markups would be replaced by images&lt;/td&gt;&lt;td&gt;&lt;tt&gt;true&lt;/tt&gt; (default)&lt;br/&gt;&lt;tt&gt;false&lt;/tt&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;tr&gt;&lt;td&gt;&lt;tt&gt;subsections&lt;/tt&gt;&lt;/td&gt;&lt;td&gt;Sub-sections of the section. Only used when &lt;tt&gt;type&lt;/tt&gt; is &lt;tt&gt;group&lt;/tt&gt; &lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
     * &lt;/table&gt;
     *
     * @since 1.0
     */
    @Parameter(name = &quot;docsite&quot;)
    Docsite docsite;

    /**

     * Set a custom color theme that would be applied to the site.
     * Value formats accepted are defined by
     * &lt;a href=&quot;https://developer.mozilla.org/es/docs/Web/CSS/color_value&quot;&gt;CSS colors&lt;/a&gt;.
     * &lt;pre&gt;&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;themeColors&amp;gt;
     *   &amp;lt;menuRegularBackgroundColor&amp;gt;&amp;lt;/menuRegularBackgroundColor&amp;gt;
     *   &amp;lt;menuBoldBackgroundColor&amp;gt;&amp;lt;/menuBoldBackgroundColor&amp;gt;
     *   &amp;lt;menuForegroundColor&amp;gt;&amp;lt;/menuForegroundColor&amp;gt;
     *   &amp;lt;menuDecorationColor&amp;gt;&amp;lt;/menuDecorationColor&amp;gt;
     *   &amp;lt;guiElementColor&amp;gt;&amp;lt;/guiElementColor&amp;gt;
     * &amp;lt;/themeColors&amp;gt;
     * &lt;/code&gt;&lt;/pre&gt;
     * @since 1.0
     */
    @Parameter(name = &quot;themeColors&quot;)
    ThemeColors themeColors;

    /**
     * A local CSS file that would be used instead of the default style, in case you want
     * to use a totally different layout.
     * @since 1.0
     */
    @Parameter(name = &quot;cssFile&quot;, property = &quot;docsite.cssFile&quot;)
    File cssFile;


    @Parameter(name = &quot;useCDN&quot;, defaultValue = &quot;true&quot;, property = &quot;docsite.useCDN&quot;)
    boolean useCDN;


    @Parameter( defaultValue = &quot;${project}&quot;, readonly = true )
    MavenProject project;


    public void execute() throws MojoExecutionException, MojoFailureException {

<span class="nc" id="L135">        initializeLogger();</span>

<span class="nc" id="L137">        File[] outputFolderContent = Objects.requireNonNullElse(</span>
<span class="nc" id="L138">            outputFolder.listFiles(),</span>
            new File[0]
        );

        try {
<span class="nc bnc" id="L143" title="All 4 branches missed.">            if (outputFolder.exists() &amp;&amp; outputFolderContent.length &gt; 0) {</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                if (forceDelete) {</span>
<span class="nc" id="L145">                    Logger.instance().warn(&quot;The contents of output folder {} will be deleted&quot;, outputFolder);</span>
<span class="nc" id="L146">                    ResourceUtil.deleteDirectory(outputFolder.toPath());</span>
                } else {
<span class="nc" id="L148">                    Logger.instance().error(</span>
                        &quot;As a safety mechanism, the output folder must be empty. &quot; +
                        &quot;You can disable this check using -Ddocsite.forceDelete&quot;
                    );
<span class="nc" id="L152">                    throw new MojoFailureException(&quot;The output folder &quot;+outputFolder+&quot; is not empty&quot;);</span>
                }
            }
<span class="nc" id="L155">            Files.createDirectories(outputFolder.toPath());</span>

<span class="nc" id="L157">            themeColors = requireNonNullElse(themeColors, ThemeColors.DEFAULT);</span>

<span class="nc bnc" id="L159" title="All 2 branches missed.">            if (docsite == null) {</span>
<span class="nc" id="L160">                docsite = new Autoconfigurer(project).configuration();</span>
            }

<span class="nc" id="L163">            new DocsiteEmitter(</span>
                docsite,
                themeColors,
<span class="nc bnc" id="L166" title="All 2 branches missed.">                cssFile != null ? cssFile.toPath() : null,</span>
                useCDN,
<span class="nc" id="L168">                outputFolder.toPath()</span>
<span class="nc" id="L169">            ).generateSite();</span>

<span class="nc" id="L171">        } catch (IOException e) {</span>
<span class="nc" id="L172">            throw new MojoFailureException(&quot;Error generating site&quot;,e);</span>
<span class="nc" id="L173">        }</span>


<span class="nc" id="L176">    }</span>


    private void initializeLogger() {
<span class="nc" id="L180">        Logger.initialize(new Logger(</span>
<span class="nc" id="L181">            getLog()::debug,</span>
<span class="nc" id="L182">            getLog()::debug,</span>
<span class="nc" id="L183">            getLog()::info,</span>
<span class="nc" id="L184">            getLog()::warn,</span>
<span class="nc" id="L185">            getLog()::error</span>
        ));
<span class="nc" id="L187">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>